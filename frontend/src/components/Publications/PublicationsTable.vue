<template>  <v-data-table    :headers="headers"    :items="publications"    :search="search"    :sort-by="[{ key: 'id', order: 'desc' }]"    class="elevation-1"  >    <template #top>      <v-toolbar flat>        <v-toolbar-title class="flex-0-0">          Announcements        </v-toolbar-title>        <v-divider          class="mx-4 border-opacity-100"          vertical        />        <v-text-field          v-model="search"          append-icon="mdi-magnify"          label="Search"          variant="underlined"          color="secondary"          hide-details        />        <v-spacer />        <v-dialog          v-model="dialog"          max-width="550px"        >          <template #activator="{ props }">            <v-btn              color="secondary"              variant="elevated"              class="mb-2 mr-4"              v-bind="props"            >              New Announcement            </v-btn>          </template>          <v-card>            <v-form              ref="form"              @submit.prevent="save"            >              <v-card-title>                <span class="text-h5">{{ formTitle }}</span>              </v-card-title>              <v-card-text>                <v-row>                  <v-col cols="10">                    <v-text-field                      v-model="editedItem.title"                      :rules="[ (v) => !!v || 'Annoucement title is required', (v) => v.length <= 255 || 'Title must be shorter', ]"                      label="Name"                      required                      counter="255"                      variant="filled"                    />                  </v-col>                  <v-col                    cols="2"                    class="px-5"                  >                    <!-- improve centering and design of switch-->                    <v-switch                      v-model="editedItem.active"                      inset                    />                  </v-col>                  <v-col cols="12">                    <v-textarea                      v-model="editedItem.text"                      label="Body"                      required                      variant="filled"                      counter                      auto-grow                    />                  </v-col>                </v-row>              </v-card-text>              <v-card-actions>                <v-spacer />                <v-btn                  color="primary"                  variant="text"                  @click="close"                >                  Cancel                </v-btn>                <v-btn                  color="primary"                  variant="text"                  @click="save"                >                  Save                </v-btn>              </v-card-actions>            </v-form>          </v-card>        </v-dialog>        <v-dialog          v-model="dialogDelete"          max-width="500px"        >          <v-card>            <v-card-title class="text-h5">              Are you sure you want to delete this item?            </v-card-title>            <v-card-actions>              <v-spacer />              <v-btn                color="primary"                variant="text"                @click="closeDelete"              >                Cancel              </v-btn>              <v-btn                color="error"                variant="text"                @click="deleteItemConfirm"              >                OK              </v-btn>              <v-spacer />            </v-card-actions>          </v-card>        </v-dialog>      </v-toolbar>    </template>    <template #[`item.title`]="{ item }">      {{ item.title.length > 30 ? item.title.slice(0, 30) + '...' : item.title }}    </template>    <template #[`item.text`]="{ item }">      {{ item.text.length > 50 ? item.text.slice(0, 50) + '...' : item.text }}    </template>    <template #[`item.active`]="{ item }">      <v-chip        :color="item.active ? 'success' : 'error'"        variant="elevated"        class="capitalized"      >        {{ item.active ? 'Active' : 'Inactive' }}      </v-chip>    </template>    <template #[`item.createdAt`]="{ item }">      {{ new Date(item.createdAt).toLocaleString(undefined, { dateStyle: 'short', timeStyle: 'short', timeZone: 'UTC', }) }}    </template>    <template #[`item.actions`]="{ item }">      <v-icon        size="small"        class="mr-2"        @click="editItem(item)"      >        mdi-pencil      </v-icon>      <v-icon        size="small"        @click="deleteItem(item)"      >        mdi-delete      </v-icon>    </template>  </v-data-table></template><script>import { addPublication, updatePublications, deletePublications } from '@/api/publications.api';export default {  name: 'PublicationsTable',  props: {    passedData: {      type: Array,      default() {        return [          {            id: Number,            title: String,            text: String,            active: Number,            createdAt: String,          },        ];      },    },  },  data: () => ({    dialog: false,    dialogDelete: false,    publications: [],    search: '',    headers: [      { title: 'Title', key: 'title' },      { title: 'Text', key: 'text', sortable: false },      { title: 'Active', key: 'active', filterable: false },      { title: 'Date', key: 'createdAt', filterable: false },      { title: 'Actions', key: 'actions', sortable: false, filterable: false },    ],    editedIndex: -1,    editedItem: {      title: '',      text: '',      active: 0,    },    defaultItem: {      title: '',      text: '',      active: 0,    },  }),  computed: {    formTitle() {      return this.editedIndex === -1 ? 'New Annoucement' : 'Edit Announcement';    },  },  watch: {    dialog(val) {      val || this.close();    },    dialogDelete(val) {      val || this.closeDelete();    },  },  mounted() {    this.publications = this.passedData;  },  methods: {    editItem(item) {      this.editedIndex = this.publications.indexOf(item);      this.editedItem = Object.assign({}, item);      this.dialog = true;    },    deleteItem(item) {      this.editedIndex = this.publications.indexOf(item);      this.dialogDelete = true;    },    async deleteItemConfirm() {      try {        await deletePublications(this.publications[this.editedIndex].id);        const deleted = this.publications.splice(this.editedIndex, 1);        this.$notify({          type: 'success',          title: 'Announcement deleted',          text: `You have deleted announcement ${deleted[0].title}`,        });      } finally {        this.closeDelete();      }    },    close() {      this.dialog = false;      this.$refs.form.resetValidation();      this.$nextTick(() => {        this.editedItem = Object.assign({}, this.defaultItem);        this.editedIndex = -1;      });    },    closeDelete() {      this.dialogDelete = false;      this.$nextTick(() => {        this.editedItem = Object.assign({}, this.defaultItem);        this.editedIndex = -1;      });    },    async save() {      // Don't save if validation is unsuccessful      if (!this.$refs.form.validate()) return;      try {        if (this.editedIndex > -1) {          const response = await updatePublications(this.publications[this.editedIndex].id, {            ...this.editedItem,            active: this.editedItem.active ? 1 : 0,          });          this.publications.splice(this.editedIndex, 1, response.data);          this.$notify({            type: 'success',            title: 'Announcement updated',            text: `You have updated announcement ${response.data.title}`,          });        } else {          const response = await addPublication(this.editedItem);          this.publications.push(response.data);          this.$notify({            type: 'success',            title: 'Announcement created',            text: `You have created announcement ${response.data.title}`,          });        }      } finally {        this.close();      }    },  },};</script>